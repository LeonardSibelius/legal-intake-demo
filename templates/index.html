<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent AI Demo | Engine Room AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3a5f 0%, #0f2744 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Login Screen */
        .login-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }

        .login-container.hidden {
            display: none;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .login-logo i {
            font-size: 36px;
            color: #d4af37;
        }

        .login-container h1 {
            color: #1e3a5f;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .login-tagline {
            color: #d4af37;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .login-container p {
            color: #64748b;
            margin-bottom: 20px;
            font-size: 14px;
        }

        /* Agent Grid on Login */
        .agent-preview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 12px;
        }

        .agent-chip {
            background: white;
            padding: 6px 4px;
            border-radius: 8px;
            font-size: 9px;
            color: #475569;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            border: 1px solid #e2e8f0;
        }

        .agent-chip i {
            font-size: 14px;
            color: #1e3a5f;
        }

        .login-container input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .login-container input:focus {
            outline: none;
            border-color: #1e3a5f;
        }

        .login-container button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .login-container button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(30, 58, 95, 0.3);
        }

        .login-error {
            color: #dc2626;
            font-size: 14px;
            margin-bottom: 15px;
            display: none;
        }

        /* Chat Container */
        .chat-container {
            display: none;
            width: 100%;
            max-width: 520px;
            height: 750px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            flex-direction: column;
        }

        .chat-container.active {
            display: flex;
        }

        /* Chat Header */
        .chat-header {
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
            padding: 15px 20px;
        }

        .header-top {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .header-avatar {
            width: 45px;
            height: 45px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-avatar i {
            font-size: 20px;
            color: #d4af37;
        }

        .header-info h2 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .header-info p {
            font-size: 11px;
            opacity: 0.9;
        }

        .header-status {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Agent Bar */
        .agent-bar {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 2px;
        }

        .agent-bar::-webkit-scrollbar {
            display: none;
        }

        .agent-indicator {
            flex-shrink: 0;
            padding: 4px 10px;
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            font-size: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .agent-indicator.active {
            background: #d4af37;
            color: #1e3a5f;
            font-weight: 600;
        }

        .agent-indicator i {
            font-size: 10px;
        }

        /* Messages Area */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: #f8fafc;
        }

        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.assistant {
            background: white;
            color: #334155;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .message.user {
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message.system {
            background: #fef3c7;
            color: #92400e;
            align-self: center;
            font-size: 12px;
            padding: 8px 16px;
            border-radius: 20px;
            max-width: 90%;
            text-align: center;
        }

        .message-agent {
            font-size: 10px;
            color: #94a3b8;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .message-agent i {
            font-size: 10px;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: white;
            padding: 15px 20px;
            border-radius: 16px;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .typing-indicator.active {
            display: flex;
            gap: 5px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #94a3b8;
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }

        /* Input Area */
        .chat-input {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #1e3a5f;
        }

        .chat-input button {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .chat-input button:hover {
            transform: scale(1.05);
        }

        .chat-input button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-complete {
            background: linear-gradient(135deg, #059669, #10b981) !important;
            border-radius: 25px !important;
            width: auto !important;
            padding: 0 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .btn-complete:hover {
            transform: scale(1.02);
        }

        /* Complete Intake Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #1e3a5f;
            font-size: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #64748b;
            cursor: pointer;
        }

        .pipeline-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .pipeline-step.complete {
            background: #ecfdf5;
        }

        .pipeline-step.active {
            background: #fef3c7;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
        }

        .pipeline-step.complete .step-icon {
            background: #10b981;
            color: white;
        }

        .pipeline-step.active .step-icon {
            background: #f59e0b;
            color: white;
            animation: pulse 1s infinite;
        }

        .step-info h4 {
            font-size: 14px;
            color: #1e3a5f;
            margin-bottom: 2px;
        }

        .step-info p {
            font-size: 12px;
            color: #64748b;
        }

        .results-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .results-section h4 {
            color: #1e3a5f;
            margin-bottom: 15px;
        }

        .lead-score-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 18px;
        }

        .lead-score-badge.hot {
            background: #fee2e2;
            color: #dc2626;
        }

        .lead-score-badge.warm {
            background: #fef3c7;
            color: #d97706;
        }

        .lead-score-badge.cold {
            background: #e0f2fe;
            color: #0284c7;
        }

        /* Branding */
        .powered-by {
            text-align: center;
            padding: 15px;
            color: rgba(255,255,255,0.7);
            font-size: 12px;
        }

        .powered-by a {
            color: #d4af37;
            text-decoration: none;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 540px) {
            .chat-container {
                height: calc(100vh - 80px);
                border-radius: 16px;
            }
            .agent-preview {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-logo">
            <i class="fa-solid fa-scale-balanced"></i>
        </div>
        <h1>Multi-Agent AI System</h1>
        <p class="login-tagline">"We don't sell you a chatbot. We give you a team."</p>
        <p>Many specialized agents working together 24/7</p>

        <div class="agent-preview">
            <div class="agent-chip">
                <i class="fa-solid fa-comments"></i>
                <span>Intake</span>
            </div>
            <div class="agent-chip">
                <i class="fa-solid fa-language"></i>
                <span>Spanish</span>
            </div>
            <div class="agent-chip">
                <i class="fa-solid fa-fire"></i>
                <span>Scorer</span>
            </div>
            <div class="agent-chip">
                <i class="fa-solid fa-envelope"></i>
                <span>Follow-up</span>
            </div>
            <div class="agent-chip">
                <i class="fa-solid fa-calendar"></i>
                <span>Scheduler</span>
            </div>
            <div class="agent-chip">
                <i class="fa-solid fa-folder"></i>
                <span>Documents</span>
            </div>
            <div class="agent-chip">
                <i class="fa-solid fa-book"></i>
                <span>Research</span>
            </div>
            <div class="agent-chip">
                <i class="fa-solid fa-user-tie"></i>
                <span>Handoff</span>
            </div>
        </div>

        <p class="login-error" id="loginError">Invalid password. Please try again.</p>
        <input type="password" id="passwordInput" placeholder="Enter demo password" onkeypress="if(event.key==='Enter')verifyPassword()">
        <button onclick="verifyPassword()">Launch Demo</button>
    </div>

    <!-- Chat Interface -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <div class="header-top">
                <div class="header-avatar">
                    <i class="fa-solid fa-scale-balanced"></i>
                </div>
                <div class="header-info">
                    <h2>Engine Room AI</h2>
                    <p>Many Agents ‚Ä¢ 24/7 ‚Ä¢ English & Espa√±ol</p>
                </div>
                <div class="header-status">
                    <div class="status-dot"></div>
                    All Online
                </div>
            </div>
            <div class="agent-bar">
                <div class="agent-indicator active" id="agent-intake">
                    <i class="fa-solid fa-comments"></i> Intake
                </div>
                <div class="agent-indicator" id="agent-spanish">
                    <i class="fa-solid fa-language"></i> Spanish
                </div>
                <div class="agent-indicator" id="agent-scorer">
                    <i class="fa-solid fa-fire"></i> Scorer
                </div>
                <div class="agent-indicator" id="agent-followup">
                    <i class="fa-solid fa-envelope"></i> Follow-up
                </div>
                <div class="agent-indicator" id="agent-scheduler">
                    <i class="fa-solid fa-calendar"></i> Scheduler
                </div>
                <div class="agent-indicator" id="agent-docs">
                    <i class="fa-solid fa-folder"></i> Docs
                </div>
                <div class="agent-indicator" id="agent-research">
                    <i class="fa-solid fa-book"></i> Research
                </div>
                <div class="agent-indicator" id="agent-handoff">
                    <i class="fa-solid fa-user-tie"></i> Handoff
                </div>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message system">
                <i class="fa-solid fa-circle-info"></i> Multi-Agent AI System Active ‚Ä¢ Bilingual Detection Enabled
            </div>
            <div class="message assistant">
                <div class="message-agent"><i class="fa-solid fa-comments"></i> Intake Agent</div>
                Hello! Welcome to our law firm. I'm here to help get you started.
                <br><br>
                Could you tell me a little about what brings you to us today? We handle personal injury, car accidents, workplace injuries, and more.
                <br><br>
                <em>(You can also write in Spanish - hablo espa√±ol tambi√©n!)</em>
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <div class="chat-input">
            <input type="text" id="messageInput" placeholder="Type your message..." onkeypress="if(event.key==='Enter')sendMessage()">
            <button onclick="sendMessage()" id="sendBtn">
                <i class="fa-solid fa-paper-plane"></i>
            </button>
            <button class="btn-complete" onclick="completeIntake()" id="completeBtn" title="Run full multi-agent pipeline">
                <i class="fa-solid fa-check-double"></i> Analyze
            </button>
        </div>
    </div>

    <!-- Pipeline Modal -->
    <div class="modal" id="pipelineModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fa-solid fa-gears"></i> Running Agent Pipeline</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>

            <div id="pipelineSteps">
                <div class="pipeline-step" id="step-1">
                    <div class="step-icon"><i class="fa-solid fa-fire"></i></div>
                    <div class="step-info">
                        <h4>Lead Scoring Agent</h4>
                        <p>Analyzing conversation for HOT/WARM/COLD classification...</p>
                    </div>
                </div>
                <div class="pipeline-step" id="step-2">
                    <div class="step-icon"><i class="fa-solid fa-book"></i></div>
                    <div class="step-info">
                        <h4>Research Agent</h4>
                        <p>Conducting legal research & statute lookups...</p>
                    </div>
                </div>
                <div class="pipeline-step" id="step-3">
                    <div class="step-icon"><i class="fa-solid fa-user-tie"></i></div>
                    <div class="step-info">
                        <h4>Handoff Agent</h4>
                        <p>Determining routing & escalation...</p>
                    </div>
                </div>
                <div class="pipeline-step" id="step-4">
                    <div class="step-icon"><i class="fa-solid fa-envelope"></i></div>
                    <div class="step-info">
                        <h4>Follow-up Agent</h4>
                        <p>Generating SMS/email nurture sequence...</p>
                    </div>
                </div>
                <div class="pipeline-step" id="step-5">
                    <div class="step-icon"><i class="fa-solid fa-folder"></i></div>
                    <div class="step-info">
                        <h4>Document Collector</h4>
                        <p>Preparing evidence request list...</p>
                    </div>
                </div>
                <div class="pipeline-step" id="step-6">
                    <div class="step-icon"><i class="fa-solid fa-calendar"></i></div>
                    <div class="step-info">
                        <h4>Scheduler Agent</h4>
                        <p>Checking availability for priority booking...</p>
                    </div>
                </div>
            </div>

            <div class="results-section" id="resultsSection" style="display:none;">
                <h4><i class="fa-solid fa-chart-line"></i> Pipeline Results</h4>
                <div id="resultsContent"></div>
            </div>
        </div>
    </div>

    <div class="powered-by">
        Powered by <a href="https://engineroom-ai.com" target="_blank">Engine Room AI</a> ‚Ä¢ Many Agents Working as One
    </div>

    <script>
        let sessionId = null;
        let currentAgent = 'intake';
        let messageCount = 0;

        async function verifyPassword() {
            const password = document.getElementById('passwordInput').value;

            try {
                const response = await fetch('/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (data.success) {
                    sessionId = data.session_id;
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('chatContainer').classList.add('active');
                } else {
                    document.getElementById('loginError').style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function updateActiveAgent(agent) {
            // Map agent names to element IDs
            const agentMap = {
                'intake': 'agent-intake',
                'spanish': 'agent-spanish',
                'lead_scorer': 'agent-scorer',
                'followup': 'agent-followup',
                'scheduler': 'agent-scheduler',
                'document_collector': 'agent-docs',
                'research': 'agent-research',
                'handoff': 'agent-handoff'
            };

            // Remove active from all
            document.querySelectorAll('.agent-indicator').forEach(el => {
                el.classList.remove('active');
            });

            // Add active to current
            const agentEl = document.getElementById(agentMap[agent] || 'agent-intake');
            if (agentEl) {
                agentEl.classList.add('active');
            }

            currentAgent = agent;
        }

        function getAgentLabel(agent) {
            const labels = {
                'intake': 'Intake Agent',
                'spanish': 'Spanish Agent',
                'lead_scorer': 'Lead Scorer',
                'followup': 'Follow-up Agent',
                'scheduler': 'Scheduler Agent',
                'document_collector': 'Document Collector',
                'research': 'Research Agent',
                'handoff': 'Handoff Agent'
            };
            return labels[agent] || 'Intake Agent';
        }

        function getAgentIcon(agent) {
            const icons = {
                'intake': 'fa-comments',
                'spanish': 'fa-language',
                'lead_scorer': 'fa-fire',
                'followup': 'fa-envelope',
                'scheduler': 'fa-calendar',
                'document_collector': 'fa-folder',
                'research': 'fa-book',
                'handoff': 'fa-user-tie'
            };
            return icons[agent] || 'fa-comments';
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message) return;

            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            messageCount++;

            // Show typing indicator
            document.getElementById('typingIndicator').classList.add('active');
            document.getElementById('sendBtn').disabled = true;

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();

                // Hide typing indicator
                document.getElementById('typingIndicator').classList.remove('active');
                document.getElementById('sendBtn').disabled = false;

                if (data.response) {
                    // Update active agent
                    updateActiveAgent(data.agent || 'intake');

                    // Add message with agent label
                    addMessage(data.response, 'assistant', data.agent);

                    // Show language detection if Spanish
                    if (data.language === 'spanish' && currentAgent !== 'spanish') {
                        addMessage('üåê Spanish detected - Agente biling√ºe activado', 'system');
                    }

                    // Check for escalation
                    if (data.escalated) {
                        addMessage('‚ö†Ô∏è PRIORITY ESCALATION - Human staff being notified', 'system');
                    }
                } else if (data.error) {
                    addMessage('I apologize, but I encountered an issue. Please try again.', 'assistant');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('typingIndicator').classList.remove('active');
                document.getElementById('sendBtn').disabled = false;
                addMessage('I apologize, but I encountered a connection issue. Please try again.', 'assistant');
            }
        }

        function addMessage(text, type, agent = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const typingIndicator = document.getElementById('typingIndicator');

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;

            if (type === 'assistant' && agent) {
                const agentLabel = document.createElement('div');
                agentLabel.className = 'message-agent';
                agentLabel.innerHTML = `<i class="fa-solid ${getAgentIcon(agent)}"></i> ${getAgentLabel(agent)}`;
                messageDiv.appendChild(agentLabel);
            }

            const textNode = document.createTextNode(text);
            messageDiv.appendChild(textNode);

            // Insert before typing indicator
            messagesContainer.insertBefore(messageDiv, typingIndicator);

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function completeIntake() {
            if (messageCount < 2) {
                alert('Please have a conversation first (at least 2 messages) before running the full pipeline.');
                return;
            }

            // Show modal
            document.getElementById('pipelineModal').classList.add('active');
            document.getElementById('resultsSection').style.display = 'none';

            // Reset steps
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`step-${i}`).className = 'pipeline-step';
            }

            // Animate through steps
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`step-${i}`).classList.add('active');
                await sleep(500);
                document.getElementById(`step-${i}`).classList.remove('active');
                document.getElementById(`step-${i}`).classList.add('complete');
            }

            try {
                const response = await fetch('/complete-intake', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ state: 'Nevada' })
                });

                const data = await response.json();

                if (data.success) {
                    showResults(data);
                } else {
                    alert('Error running pipeline: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error connecting to server');
            }
        }

        function showResults(data) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsContent = document.getElementById('resultsContent');

            const score = data.lead_score || {};
            const rating = score.rating || 'WARM';
            const ratingClass = rating.toLowerCase();

            resultsContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <span class="lead-score-badge ${ratingClass}">
                        ${rating === 'HOT' ? 'üî•' : rating === 'WARM' ? '‚òÄÔ∏è' : '‚ùÑÔ∏è'}
                        ${rating} LEAD
                    </span>
                    <div style="margin-top: 10px; color: #64748b;">
                        Score: ${score.score || 'N/A'}/100
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Case Type:</strong> ${score.case_type || 'Personal Injury'}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Estimated Value:</strong> ${score.estimated_value || 'Medium'}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Key Factors:</strong>
                    <ul style="margin-top: 5px; padding-left: 20px;">
                        ${(score.key_factors || ['Evidence of injury']).map(f => `<li>${f}</li>`).join('')}
                    </ul>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Recommended Action:</strong> ${score.recommended_action || 'Schedule consultation'}
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #ecfdf5; border-radius: 10px;">
                    <strong style="color: #059669;">‚úì Pipeline Complete</strong>
                    <p style="margin-top: 5px; font-size: 13px; color: #047857;">
                        All agents have processed this intake. Follow-up sequence generated,
                        documents requested, and attorney routing determined.
                    </p>
                </div>
            `;

            resultsSection.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('pipelineModal').classList.remove('active');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Auto-focus on password input
        document.getElementById('passwordInput').focus();
    </script>
</body>
</html>
